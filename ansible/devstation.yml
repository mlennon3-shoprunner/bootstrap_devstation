---
- hosts: 127.0.0.1
  connection: local
  tasks:
    - lineinfile: dest="~/.bash_profile" create=yes mode=644 line='export HOMEBREW_CASK_OPTS="--appdir=/Applications"'
    - homebrew_tap: tap=caskroom/cask state=present
    - name: Install homebrew packages
      homebrew: name={{ item }} state=latest
      with_items:
        - wget
        - vim
        - tmux
        - ctags
        - brew-cask
        - reattach-to-user-namespace

    - name: Install homebrew cask packages
      homebrew_cask: name={{ item }} state=present
      environment:
        HOMEBREW_CASK_OPTS: --appdir=/Applications
      with_items:
        - vagrant
        - virtualbox
        - iterm2
        - alfred
        - google-chrome
        - firefox
        - caffeine
        - cinch
        - chefdk

    - name: Install vagrant berkshelf
      shell: vagrant plugin install vagrant-berkshelf

    - name: install janus for vim
      shell: curl -Lo- https://bit.ly/janus-bootstrap | bash creates=~/.vim.old/

    - name: mkdir ~/.janus
      shell: mkdir -p ~/.janus

    - name: install vim plugins
      shell: git clone https://github.com/{{ item.url }} chdir=~/.janus creates=~/.janus/{{ item.name  }}
      with_items:
        - { url: 'xolox/vim-misc', name: 'vim-misc' }
        - { url: 'christoomey/vim-tmux-navigator', name: 'vim-tmux-navigator' }
        - { url: 'xolox/vim-easytags', name: 'vim-easytags' }

    - name: copy config files
      copy: src=files/{{ item }} dest=~/.{{ item }}
      with_items:
        - vimrc.after
        - tmux.conf
        - bash_profile
        - gitconfig

    - name: set vim as git editor
      shell: 'git config --global core.editor /usr/bin/vim'

    - name: make keyboard repeat fast
      shell: defaults write NSGlobalDomain KeyRepeat -int 0
